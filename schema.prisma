datasource db {
  provider = "sqlite"
  url      = "file:dev.db"
}

generator client {
  // Corresponds to the cargo alias created earlier
  provider = "cargo prisma"
  // The location to generate the client. Is relative to the position of the schema
  output   = "./crates/prisma/prisma.rs"
}

model Identity {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  username       String?        @unique
  primaryEmail   String?        @unique
  passwordHash   String?
  LoginProcesses LoginProcess[] // one-to-many relation
  Sessions       Session[] // one-to-many relation
}

model Email {
  email      String    @id @unique
  verified   Boolean
  verifiedAt DateTime?
}

model LinkedAccount {
  id         String @id @default(cuid())
  providerId String
}

model LoginProcess {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  identityId  String
  ipAddress   String?
  expiresAt   DateTime
  completed   Boolean  @default(false)
  currentStep String
  magicLink   String?
  Identity    Identity @relation(fields: [identityId], references: [id])
}

model Session {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  revokedAt DateTime?

  refreshToken String
  identityId   String
  Identity     Identity @relation(fields: [identityId], references: [id])
}
